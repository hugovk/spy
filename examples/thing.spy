from operator import OpImpl, OpArg
from unsafe import gc_alloc, ptr

@blue
def ndarray1(DTYPE):

    @struct
    class ArrayData:
        length: i32
        items: ptr[DTYPE]

    @typelift
    class ndarray:
        __ll__: ptr[ArrayData]

        def __new__(cls: type, length: i32) -> ndarray:
            data = gc_alloc(ArrayData)(1)
            data.length = length
            data.items = gc_alloc(DTYPE)(length)
            i = 0
            while i < length:
                data.items[i] = 0
                i = i + 1
            return ndarray.__lift__(data)


        @blue
        def __GETITEM__(v_arr: OpArg, v_i: OpArg) -> OpImpl:

            def getitem(arr: ndarray, i: i32) -> DTYPE:
                ll = arr.__ll__
                if i >= ll.length:
                    print('IndexError')
                    # raise...
                return ll.items[i]

            return OpImpl(getitem)

    return ndarray
